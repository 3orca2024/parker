<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Princess Arcade ✨</title>
  <style>
    body {
      margin:0;
      font-family: "Comic Sans MS", cursive;
      background: linear-gradient(to bottom,#ffe6ff,#fff0f9);
      text-align:center;
      color:#5c2a72;
    }
    h1 {
      font-size: 36px;
      margin:10px;
      color:#b03fb0;
      text-shadow: 2px 2px #ffd6f5;
    }
    #menu button, #game-tabs button, #shop button, #milestones button, #instructions button {
      margin:5px;
      padding:10px 20px;
      border:none;
      border-radius:12px;
      background:#ffb3ec;
      color:#5c2a72;
      font-size:16px;
      cursor:pointer;
      transition:0.3s;
    }
    #menu button:hover, #game-tabs button:hover, #shop button:hover, #milestones button:hover, #instructions button:hover {
      background:#ff66cc;
      color:white;
    }
    canvas {
      border:3px solid #c76dc7;
      border-radius:15px;
      margin:10px auto;
      display:block;
      background:white;
    }
    #hud {
      margin:10px;
      font-size:18px;
    }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>🌸 Princess Arcade 🌸</h1>
  <div id="hud">Coins: <span id="coins">0</span> | Hearts: <span id="hearts">3</span></div>

  <!-- Princess Picker -->
  <div id="picker">
    <h2>Choose Your Princess 👑</h2>
    <button onclick="selectPrincess('Amelia','#f99')">Princess Amelia</button>
    <button onclick="selectPrincess('Bella','#9f9')">Princess Bella</button>
    <button onclick="selectPrincess('Celeste','#99f')">Princess Celeste</button>
  </div>

  <!-- Menu -->
  <div id="menu">
    <h2>Main Menu</h2>
    <button onclick="showTab('game-tabs')">🎮 Play Games</button>
    <button onclick="showTab('shop')">💎 Shop</button>
    <button onclick="showTab('milestones')">🎀 Milestones</button>
    <button onclick="showTab('instructions')">📖 Instructions</button>
  </div>

  <!-- Game Tabs -->
  <div id="game-tabs" class="hidden">
    <h2>Choose a Game</h2>
    <button onclick="setGame('flap')">🪽 Princess Flap</button>
    <button onclick="setGame('runner')">🏃‍♀️ Princess Runner</button>
    <button onclick="setGame('puzzle')">🧩 Princess Puzzle</button>
    <br>
    <button id="startBtn">▶️ Start</button>
    <button id="resetBtn">⏹ Reset</button>
  </div>

  <!-- Canvas -->
  <canvas id="mainCanvas" width="480" height="320"></canvas>

  <!-- Shop -->
  <div id="shop" class="hidden">
    <h2>Shop 💎</h2>
    <button onclick="buyHeart()">Buy Heart (20 coins)</button>
  </div>

  <!-- Milestones -->
  <div id="milestones" class="hidden">
    <h2>Milestones 🎀</h2>
    <p>Earn coins to unlock magical backgrounds!</p>
  </div>

  <!-- Instructions -->
  <div id="instructions" class="hidden">
    <h2>Instructions 📖</h2>
    <p>Princess Flap: Tap to fly and avoid magic wands (+2 coins)</p>
    <p>Princess Runner: Jump over obstacles, collect coins (+1 coin)</p>
    <p>Princess Puzzle: Solve the magical 3x3 puzzle (+10 coins)</p>
    <p>Spend coins in the Shop for hearts, unlock backgrounds with milestones!</p>
  </div>

<script>
let coins=0, hearts=3;
let selectedPrincess=null;
let currentGame=null;
let mainCanvas=document.getElementById("mainCanvas");
let ctx=mainCanvas.getContext("2d");

// HUD
function updateHUD(){
  document.getElementById("coins").textContent=coins;
  document.getElementById("hearts").textContent=hearts;
}
function giveCoins(n){coins+=n;updateHUD();}
function loseHeart(){hearts--; if(hearts<=0){alert("Game over! Out of hearts.");hearts=3;} updateHUD();}
function buyHeart(){if(coins>=20){coins-=20;hearts++;updateHUD();}else alert("Not enough coins!");}

// Princess Picker
function selectPrincess(name,color){
  selectedPrincess={name,color};
  document.getElementById("picker").classList.add("hidden");
  alert(name+" is ready for adventure!");
}

// Menu
function showTab(tab){
  ["game-tabs","shop","milestones","instructions"].forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById(tab).classList.remove("hidden");
}

// --- GAME LOGIC ---

// Princess Flap (with wand obstacles)
let flapState={};
function flapInit(){
  flapState={running:true,y:150,v:0,gravity:0.6,pipes:[],frames:0,score:0};
}
function drawStar(cx,cy,spikes,outer,inner,color){
  ctx.save();
  ctx.beginPath();
  ctx.translate(cx,cy);
  ctx.moveTo(0,0-outer);
  for(let i=0;i<spikes;i++){
    ctx.rotate(Math.PI/spikes);
    ctx.lineTo(0,0-inner);
    ctx.rotate(Math.PI/spikes);
    ctx.lineTo(0,0-outer);
  }
  ctx.closePath();
  ctx.fillStyle=color;
  ctx.fill();
  ctx.restore();
}
function flapLoop(){
  if(!flapState.running)return;
  ctx.clearRect(0,0,480,320);
  flapState.frames++;
  if(flapState.frames%100===0){
    let top=50+Math.random()*150;
    flapState.pipes.push({x:480,y:top});
  }
  flapState.y+=flapState.v;
  flapState.v+=flapState.gravity;

  // princess
  ctx.fillStyle=selectedPrincess?selectedPrincess.color:"#f9c";
  ctx.beginPath();ctx.arc(80,flapState.y,15,0,Math.PI*2);ctx.fill();

  for(let p of flapState.pipes){
    p.x-=2;

    // Top wand
    ctx.fillStyle="#d291ff";
    ctx.fillRect(p.x+15,0,10,p.y-60);
    drawStar(p.x+20,p.y-70,5,15,6,"#fff200");

    // Bottom wand
    ctx.fillStyle="#d291ff";
    ctx.fillRect(p.x+15,p.y+60,10,320-(p.y+60));
    drawStar(p.x+20,p.y+70,5,15,6,"#fff200");

    if(80>p.x && 80<p.x+40 &&
      (flapState.y<p.y-40 || flapState.y>p.y+40)){
      loseHeart();flapState.running=false;
    }
    if(p.x===40){flapState.score++;giveCoins(2);}
  }
  ctx.fillStyle="#333";ctx.fillText("Score:"+flapState.score,10,20);
  requestAnimationFrame(flapLoop);
}
mainCanvas.addEventListener("click",()=>{if(currentGame==="flap")flapState.v=-8;});

// Princess Runner
let runnerState={};
function runnerInit(){
  runnerState={running:true,player:{x:60,y:260,vy:0},gravity:0.8,obstacles:[],coinsOnTrack:[],frames:0,score:0};
}
function runnerLoop(){
  if(!runnerState.running)return;
  ctx.clearRect(0,0,480,320);
  ctx.fillStyle="#ccc";ctx.fillRect(0,280,480,40);
  runnerState.frames++;
  if(runnerState.frames%90===0)runnerState.obstacles.push({x:480,y:260});
  if(runnerState.frames%70===0)runnerState.coinsOnTrack.push({x:480,y:230});
  runnerState.player.y+=runnerState.player.vy;runnerState.player.vy+=runnerState.gravity;
  if(runnerState.player.y>260){runnerState.player.y=260;runnerState.player.vy=0;}
  ctx.fillStyle=selectedPrincess?selectedPrincess.color:"#f9c";
  ctx.fillRect(runnerState.player.x,runnerState.player.y,20,20);
  for(let o of runnerState.obstacles){o.x-=3;ctx.fillStyle="#900";ctx.fillRect(o.x,o.y,20,20);
    if(runnerState.player.x<o.x+20 && runnerState.player.x+20>o.x && runnerState.player.y+20>o.y){loseHeart();runnerState.running=false;}}
  for(let c of runnerState.coinsOnTrack){c.x-=3;ctx.fillStyle="#ff0";ctx.beginPath();ctx.arc(c.x,c.y,8,0,Math.PI*2);ctx.fill();
    if(runnerState.player.x<c.x+8 && runnerState.player.x+20>c.x && runnerState.player.y<c.y+8 && runnerState.player.y+20>c.y){giveCoins(1);c.x=-100;}}
  ctx.fillStyle="#333";ctx.fillText("Score:"+runnerState.score,10,20);
  requestAnimationFrame(runnerLoop);
}
window.addEventListener("keydown",e=>{if(e.code==="Space"&&currentGame==="runner"&&runnerState.player.y>=260)runnerState.player.vy=-12;});

// Princess Puzzle
let puzzleState={};
const puzzleIcons=["👑","💖","🌟","🏰","🦄","🪽","👸","✨"];
function puzzleInit(){
  let arr=[...puzzleIcons,null];
  arr.sort(()=>Math.random()-0.5);
  puzzleState={grid:[[],[],[]],empty:{x:0,y:0},running:true};
  for(let r=0;r<3;r++){for(let c=0;c<3;c++){let v=arr.pop();puzzleState.grid[r][c]=v;if(v===null)puzzleState.empty={x:c,y:r};}}
}
function puzzleDraw(){
  ctx.clearRect(0,0,480,320);
  const size=100, offX=90, offY=60;
  ctx.font="48px serif";ctx.textAlign="center";ctx.textBaseline="middle";
  for(let r=0;r<3;r++){for(let c=0;c<3;c++){let v=puzzleState.grid[r][c];
    if(v!==null){ctx.fillStyle="#ffb3ec";ctx.fillRect(offX+c*size,offY+r*size,size-4,size-4);
    ctx.fillStyle="#5c2a72";ctx.fillText(v,offX+c*size+size/2,offY+r*size+size/2);}}}
}
mainCanvas.addEventListener("click",e=>{
  if(currentGame!=="puzzle"||!puzzleState.running)return;
  let rect=mainCanvas.getBoundingClientRect();
  let x=(e.clientX-rect.left)*(mainCanvas.width/rect.width);
  let y=(e.clientY-rect.top)*(mainCanvas.height/rect.height);
  const size=100, offX=90, offY=60;
  let c=Math.floor((x-offX)/size), r=Math.floor((y-offY)/size);
  if(r>=0&&r<3&&c>=0&&c<3){
    let er=puzzleState.empty.y, ec=puzzleState.empty.x;
    if(Math.abs(er-r)+Math.abs(ec-c)===1){
      puzzleState.grid[er][ec]=puzzleState.grid[r][c];
      puzzleState.grid[r][c]=null;puzzleState.empty={x:c,y:r};
      puzzleDraw();checkPuzzleWin();
    }
  }
});
function checkPuzzleWin(){
  let correct=[...puzzleIcons];
  let n=0,solved=true;
  for(let r=0;r<3;r++){for(let c=0;c<3;c++){if(r===2&&c===2)continue;
    if(puzzleState.grid[r][c]!==correct[n++])solved=false;}}
  if(solved){giveCoins(10);puzzleState.running=false;alert("✨ You completed the magical puzzle! +10 coins ✨");}
}

// --- CONTROL BUTTONS ---
function setGame(g){currentGame=g;}
document.getElementById("startBtn").onclick=()=>{
  if(currentGame==="flap"){flapInit();flapLoop();}
  if(currentGame==="runner"){runnerInit();runnerLoop();}
  if(currentGame==="puzzle"){puzzleInit();puzzleDraw();}
};
document.getElementById("resetBtn").onclick=()=>{
  ctx.clearRect(0,0,480,320);
  flapState.running=false;runnerState.running=false;puzzleState.running=false;
};
</script>
</body>
</html>
